angular.module("gthiveApp",["app.routes","mainCtrl","buildingCtrl","buildingService","uiGmapgoogle-maps","smart-table"]).config(["uiGmapGoogleMapApiProvider",function(i){i.configure({v:"3.20",libraries:"geometry,visualization"})}]),angular.module("app.routes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(i,e){i.when("/",{templateUrl:"app/views/pages/home.html"}).when("/login",{templateUrl:"app/views/pages/login.html"}).when("/buildings/:bid",{templateUrl:"app/views/pages/building.html",controller:"buildingController"}),e.html5Mode(!0)}]),angular.module("buildingCtrl",["buildingService","chart.js"]).controller("buildingController",["$scope","$routeParams","Building",function(i,e,o){i.labels=["12am","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12pm","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"],i.series=["Average","Today"],i.legend=!0,i.building_name="Building name",o.getInfo(e.bid).then(function(e){i.building_name=e.data.name,console.log("buldingname",i.building_name)}),i.data=[],o.graphdata(e.bid).then(function(o){console.log("got graph data for bid=",e.bid),i.data=[o.data.averages,o.data.today]}),i.safeFloors=[],o.getFloors(e.bid).then(function(e){var o=[];e.data.forEach(function(i){o.push({name:"Floor "+i.floor,occupancy:i.occupancy})}),i.safeFloors=o})}]),angular.module("mainCtrl",["uiGmapgoogle-maps","buildingService"]).controller("mainController",["$scope","uiGmapGoogleMapApi","Building","$log",function(i,e,o,a){var n=this;n.processing=!0,i.markers=[],i.safeBuildings=[],i.itemsByPage=15,i.selectedMarker={},i.infoWindow={options:{show:!1},templateUrl:"app/views/templates/info.html",templateParameter:{title:"",occupancy:"",building_id:-1}},i.rowCollection=[{firstName:"Laurent",lastName:"Renard",balance:102,email:"whatever@gmail.com"},{firstName:"Blandine",lastName:"Faivre",balance:-2323.22,email:"oufblandou@gmail.com"},{firstName:"Francoise",lastName:"Frere",balance:42343,email:"raymondef@gmail.com"}],i.mapOptions={disableDefaultUI:!0,scrollwheel:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"}]}]},i.closeClick=function(){i.infoWindow.options.show=!1},e.then(function(e){return i.map={center:{latitude:33.7764,longitude:-84.3985},zoom:16,options:i.mapOptions},o.all()}).then(function(e){n.buildings=[],e.data.forEach(function(e){i.safeBuildings.push(e),e.show_on_map&&n.buildings.push(e)});for(var o=function(e,o){var t={id:e,coords:{latitude:o.latitude,longitude:o.longitude},options:{title:o.name,labelContent:o.abbreviation}};return o.occupancy<=.4*o.capacity?t.icon="http://maps.google.com/mapfiles/ms/icons/green-dot.png":o.occupancy<=.8*o.capacity?t.icon="http://maps.google.com/mapfiles/ms/icons/yellow-dot.png":t.icon="http://maps.google.com/mapfiles/ms/icons/red-dot.png",t.onClick=function(){a.log(t.options.title+" clicked!"),i.$apply(function(){i.selectedMarker=t,i.infoWindow.templateParameter.title=t.options.title,i.infoWindow.templateParameter.occupancy=n.buildings[t.id].occupancy,console.log("marker id",t.id),console.log("bid",n.buildings[t.id].bid),i.infoWindow.templateParameter.building_id=n.buildings[t.id].bid,i.infoWindow.options.show=!0})},t},t=0;t<n.buildings.length;t++)i.markers.push(o(t,n.buildings[t]))})["catch"](function(){a.log("Error occurred, see logs.")}).then(function(){n.processing=!1})}]),angular.module("buildingService",[]).factory("Building",["$http","$log",function(i,e){var o={};return o.all=function(){return i.get("/api/buildings")},o.graphdata=function(e){return i.get("/api/graphdata/"+e)},o.getFloors=function(e){return i.get("/api/buildings/"+e)},o.getInfo=function(e){return i.get("/api/building_info/"+e)},o}]);